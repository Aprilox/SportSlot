// ===========================================
// SPORTSLOT - Sch√©ma de base de donn√©es
// ===========================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite" // Changer pour "postgresql" ou "mysql" en production
  url      = env("DATABASE_URL")
}

// ===========================================
// AUTHENTIFICATION
// ===========================================

model AdminCredentials {
  id        String   @id @default("admin")
  username  String   @default("admin")
  password  String   // Hash√© avec bcrypt
  updatedAt DateTime @updatedAt
}

// ===========================================
// SPORTS
// ===========================================

model Sport {
  id       String  @id @default(uuid())
  name     String
  enabled  Boolean @default(true)
  icon     String  @default("üèÜ")
  imageUrl String?
  order    Int     @default(0)
  
  // Relation one-to-many : un sport peut avoir plusieurs cr√©neaux
  slots    TimeSlot[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ===========================================
// CR√âNEAUX
// ===========================================

model TimeSlot {
  id              String   @id @default(uuid())
  date            String   // Format: YYYY-MM-DD
  time            String   // Format: HH:MM
  duration        Int      // En minutes
  maxCapacity     Int
  currentBookings Int      @default(0)
  price           Float
  published       Boolean  @default(false) // true = visible pour les clients
  outsideWorkingHours Boolean @default(false) // true = hors horaires de travail
  
  // Champs pour les modifications non publi√©es (d√©placement/redimensionnement)
  // Ces valeurs sont utilis√©es c√¥t√© client tant que non publi√©
  originalDate     String?  // Date originale avant d√©placement
  originalTime     String?  // Heure originale avant d√©placement
  originalDuration Int?     // Dur√©e originale avant redimensionnement
  
  // Relation one-to-one avec Sport (1 cr√©neau = 1 sport)
  sportId  String
  sport    Sport    @relation(fields: [sportId], references: [id], onDelete: Cascade)
  
  // R√©servations
  bookings Booking[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([date])
  @@index([date, time])
  @@index([published])
  @@index([sportId])
}

// ===========================================
// R√âSERVATIONS
// ===========================================

model Booking {
  id             String   @id @default(uuid())
  customerName   String
  customerEmail  String
  customerPhone  String   @default("") // Num√©ro de t√©l√©phone
  numberOfPeople Int
  totalPrice     Float
  sportId        String   @default("") // ID du sport r√©serv√©
  sportName      String   // Nom du sport (d√©normalis√© pour l'historique)
  date           String
  time           String
  status         String   @default("confirmed") // confirmed, cancelled
  
  // Relations
  slotId String
  slot   TimeSlot @relation(fields: [slotId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([customerEmail])
  @@index([date])
  @@index([status])
}

// ===========================================
// PARAM√àTRES
// ===========================================

model Settings {
  id                  String @id @default("main")
  defaultSlotDuration Int    @default(60)
  defaultMaxCapacity  Int    @default(4)
  defaultPrice        Float  @default(50)
  minBookingAdvance   Int    @default(0) // D√©lai minimum de r√©servation en minutes
  dataVersion         Int    @default(0) // Version pour synchronisation
  
  // Branding (JSON stock√© comme texte)
  branding String @default("{}")
  
  // Horaires de travail (JSON)
  workingHours String @default("[]")
  
  // P√©riodes de fermeture (JSON)
  closedPeriods String @default("[]")
  
  // Configuration SMTP (JSON)
  smtp String @default("{}")
  
  updatedAt DateTime @updatedAt
}

// ===========================================
// P√âRIODES DE FERMETURE (table s√©par√©e pour requ√™tes)
// ===========================================

model ClosedPeriod {
  id        String   @id @default(uuid())
  startDate String   // Format: YYYY-MM-DD
  endDate   String   // Format: YYYY-MM-DD
  reason    String?
  published Boolean  @default(false)
  
  createdAt DateTime @default(now())
}
